@namespace LionFire.Trading.Charting
@using LightweightCharts.Blazor.Charts
@using LightweightCharts.Blazor.Customization

<div class="trading-chart-container" style="@ContainerStyle" @ref="_containerRef">
    @* Chart Controls *@
@*   
OLD - decided not to have these here    
<div class="trading-chart-controls">
        <MudSelect T="string" @bind-Value="SelectedExchange" Label="Exchange" Variant="Variant.Outlined"
                   Dense="true" Class="chart-control-select">
            <MudSelectItem Value="@("binance")">Binance</MudSelectItem>
            <MudSelectItem Value="@("phemex")">Phemex</MudSelectItem>
            <MudSelectItem Value="@("mexc")">Mexc</MudSelectItem>
            <MudSelectItem Value="@("hyperliquid")">Hyperliquid</MudSelectItem>
        </MudSelect>

        <MudSelect T="string" @bind-Value="SelectedExchangeArea" Label="Exchange Area" Variant="Variant.Outlined"
                   Dense="true" Class="chart-control-select">
            <MudSelectItem Value="@("futures")">Futures</MudSelectItem>
        </MudSelect>

        <MudTextField @bind-Value="SelectedSymbol" Label="Symbol" Variant="Variant.Outlined"
                      Dense="true" Class="chart-control-input" />
    </div>
 *@
    @if (IsLoading)
    {
        <div class="trading-chart-loading">
            <MudProgressCircular Indeterminate="true" Size="Size.Large" />
            <span>Loading chart data...</span>
        </div>
    }
    else if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <div class="trading-chart-error">
            <MudIcon Icon="@Icons.Material.Filled.Error" Color="Color.Error" />
            <span>@ErrorMessage</span>
        </div>
    }

    <div class="chart-wrapper">
        <ChartComponent @ref="_chart" />
    </div>
</div>

<style>
    .trading-chart-container {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        min-height: 200px;
        min-width: 300px;
        overflow: hidden;
    }

    .chart-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
    }

    /* Ensure the LightweightCharts canvas fills the wrapper */
    .chart-wrapper > div {
        width: 100% !important;
        height: 100% !important;
    }
    .trading-chart-controls {
        display: flex;
        gap: 12px;
        margin-bottom: 12px;
        align-items: flex-start;
    }
    .chart-control-select {
        min-width: 150px;
    }
    .chart-control-input {
        flex: 1;
        max-width: 300px;
    }
    .trading-chart-loading,
    .trading-chart-error {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        z-index: 10;
    }
    .trading-chart-error {
        color: var(--mud-palette-error);
    }
</style>
