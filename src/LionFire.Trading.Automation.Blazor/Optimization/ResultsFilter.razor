@using LionFire.Trading.Automation.Blazor.Optimization

<MudPaper Class="pa-3 mb-3" Elevation="1">
    <div class="d-flex justify-space-between align-center mb-2">
        <MudText Typo="Typo.subtitle1">
            <MudIcon Icon="@Icons.Material.Filled.FilterList" Size="Size.Small" Class="mr-1" />
            Result Filters
        </MudText>
        <div class="d-flex align-center gap-2">
            <MudText Typo="Typo.body2" Class="mud-text-secondary">
                @FilteredCount of @TotalCount
            </MudText>
            <MudIconButton Icon="@Icons.Material.Filled.Refresh"
                           Size="Size.Small"
                           OnClick="OnReset"
                           Disabled="@(!FilterState.HasActiveFilters)"
                           Title="Reset all filters" />
        </div>
    </div>

    <div class="d-flex flex-wrap gap-2 align-start">
        @* Min AD (AROI/DD%) *@
        <MudNumericField T="double?"
                         @bind-Value="FilterState.MinAD"
                         Label="Min AD"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Step="0.5"
                         Clearable="true"
                         Style="min-width: 80px; max-width: 130px; flex: 1 1 auto;" />

        @* Min AMWT *@
        <MudNumericField T="double?"
                         @bind-Value="FilterState.MinAMWT"
                         Label="Min AMWT (min)"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Step="10"
                         Min="0"
                         Clearable="true"
                         Style="min-width: 80px; max-width: 130px; flex: 1 1 auto;" />

        @* Min Fitness *@
        <MudNumericField T="double?"
                         @bind-Value="FilterState.MinFitness"
                         Label="Min Fitness"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Step="10"
                         Clearable="true"
                         Style="min-width: 80px; max-width: 130px; flex: 1 1 auto;" />

        @* Min Trades *@
        <MudNumericField T="int?"
                         @bind-Value="FilterState.MinTrades"
                         Label="Min Trades"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Step="5"
                         Min="0"
                         Clearable="true"
                         Style="min-width: 80px; max-width: 130px; flex: 1 1 auto;" />

        @* Min Win Rate *@
        <MudNumericField T="double?"
                         @bind-Value="FilterState.MinWinRate"
                         Label="Min Win Rate"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Step="0.05"
                         Min="0"
                         Max="1"
                         Format="P0"
                         Clearable="true"
                         Style="min-width: 80px; max-width: 130px; flex: 1 1 auto;" />

        @* Max Drawdown *@
        <MudNumericField T="double?"
                         @bind-Value="FilterState.MaxDrawdownPercent"
                         Label="Max DD %"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Step="5"
                         Min="0"
                         Max="100"
                         Clearable="true"
                         Style="min-width: 80px; max-width: 130px; flex: 1 1 auto;" />
    </div>

    @* Include Aborted Toggle *@
    <div class="d-flex align-center mt-3">
        <MudSwitch T="bool"
                   @bind-Value="FilterState.IncludeAborted"
                   Color="Color.Warning"
                   Label="Include Aborted Tests" />
    </div>
</MudPaper>

@code {
    [Parameter] public IOptimizationResultsVM? ViewModel { get; set; }

    private ResultsFilterState FilterState => ViewModel!.FilterState;

    private int FilteredCount => ViewModel?.FilteredCount ?? 0;
    private int TotalCount => ViewModel?.TotalCount ?? 0;

    private void OnReset()
    {
        FilterState.Reset();
    }
}
