@using LionFire.Trading.Automation.Blazor.Optimization
@inherits ReactiveComponentBase<OneShotOptimizeVM>

<MudPaper Class="pa-3 mb-3" Elevation="1">
    <div class="d-flex justify-space-between align-center mb-2">
        <MudText Typo="Typo.subtitle1">
            <MudIcon Icon="@Icons.Material.Filled.FilterList" Size="Size.Small" Class="mr-1" />
            Result Filters
        </MudText>
        <div class="d-flex align-center gap-2">
            <MudText Typo="Typo.body2" Class="mud-text-secondary">
                @FilteredCount of @TotalCount
            </MudText>
            <MudIconButton Icon="@Icons.Material.Filled.Refresh"
                           Size="Size.Small"
                           OnClick="OnReset"
                           Disabled="@(!FilterState.HasActiveFilters)"
                           Title="Reset all filters" />
        </div>
    </div>

    <MudGrid Spacing="2">
        @* Min AD (AROI/DD%) *@
        <MudItem xs="12" sm="6" md="4">
            <div class="d-flex align-center gap-2">
                <MudNumericField T="double?"
                                 @bind-Value="FilterState.MinAD"
                                 Label="Min AD"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Step="0.5"
                                 Clearable="true"
                                 Style="max-width: 150px;" />
            </div>
        </MudItem>

        @* Min AMWT *@
        <MudItem xs="12" sm="6" md="4">
            <div class="d-flex align-center gap-2">
                <MudNumericField T="double?"
                                 @bind-Value="FilterState.MinAMWT"
                                 Label="Min AMWT (min)"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Step="10"
                                 Min="0"
                                 Clearable="true"
                                 Style="max-width: 150px;" />
            </div>
        </MudItem>

        @* Min Fitness *@
        <MudItem xs="12" sm="6" md="4">
            <div class="d-flex align-center gap-2">
                <MudNumericField T="double?"
                                 @bind-Value="FilterState.MinFitness"
                                 Label="Min Fitness"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Step="10"
                                 Clearable="true"
                                 Style="max-width: 150px;" />
            </div>
        </MudItem>

        @* Min Trades *@
        <MudItem xs="12" sm="6" md="4">
            <div class="d-flex align-center gap-2">
                <MudNumericField T="int?"
                                 @bind-Value="FilterState.MinTrades"
                                 Label="Min Trades"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Step="5"
                                 Min="0"
                                 Clearable="true"
                                 Style="max-width: 150px;" />
            </div>
        </MudItem>

        @* Min Win Rate *@
        <MudItem xs="12" sm="6" md="4">
            <div class="d-flex align-center gap-2">
                <MudNumericField T="double?"
                                 @bind-Value="FilterState.MinWinRate"
                                 Label="Min Win Rate"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Step="0.05"
                                 Min="0"
                                 Max="1"
                                 Format="P0"
                                 Clearable="true"
                                 Style="max-width: 150px;" />
            </div>
        </MudItem>

        @* Max Drawdown *@
        <MudItem xs="12" sm="6" md="4">
            <div class="d-flex align-center gap-2">
                <MudNumericField T="double?"
                                 @bind-Value="FilterState.MaxDrawdownPercent"
                                 Label="Max DD %"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Step="5"
                                 Min="0"
                                 Max="100"
                                 Clearable="true"
                                 Style="max-width: 150px;" />
            </div>
        </MudItem>
    </MudGrid>

    @* Include Aborted Toggle *@
    <div class="d-flex align-center mt-3">
        <MudSwitch T="bool"
                   @bind-Value="FilterState.IncludeAborted"
                   Color="Color.Warning"
                   Label="Include Aborted Tests" />
    </div>
</MudPaper>

@code {
    private ResultsFilterState FilterState => ViewModel!.FilterState;

    private int FilteredCount => ViewModel?.FilteredCount ?? 0;
    private int TotalCount => ViewModel?.TotalCount ?? 0;

    private void OnReset()
    {
        FilterState.Reset();
    }
}
