@page "/bots/{BotId}"
@using BlazorGridStack
@using BlazorGridStack.Models
@using LionFire.Mvvm
@using LionFire.Trading.Automation
@using LionFire.Trading.Automation.Blazor.Bots.Widgets
@using LionFire.Trading.Charting
@using LionFire.Trading.Grains.Bots
@using LionFire.Reactive.Persistence
@using Microsoft.Extensions.DependencyInjection
@using Microsoft.Extensions.Logging
@using Orleans

@implements IDisposable

<div class="bot-dashboard">
    <div class="bot-header pa-2">
        <MudBreadcrumbs Items="@_breadcrumbs" />
    </div>

    <div class="bot-grid-container">
        <BlazorGridStackBody @ref="_grid"
                             GridStackOptions="@_gridOptions"
                             OnChange="OnLayoutChanged">

            @* Chart Widget - Large, top-left *@
            <BlazorGridStackWidget WidgetOptions="@(new() { X = 0, Y = 0, W = 8, H = 4, Id = "chart", MinW = 4, MinH = 2 })">
                <ChartWidget Symbol="@VM?.Value?.Symbol"
                            Exchange="@VM?.Value?.Exchange"
                            ExchangeArea="@VM?.Value?.ExchangeArea"
                            TimeFrame="@VM?.Value?.TimeFrame" />
            </BlazorGridStackWidget>

            @* Account Summary Widget - Top-right *@
            <BlazorGridStackWidget WidgetOptions="@(new() { X = 8, Y = 0, W = 4, H = 2, Id = "account", MinW = 2, MinH = 2 })">
                <AccountWidget AccountStatus="@AccountStatus" />
            </BlazorGridStackWidget>

            @* Bot Info/Controls Widget *@
            <BlazorGridStackWidget WidgetOptions="@(new() { X = 8, Y = 2, W = 4, H = 2, Id = "info", MinW = 2, MinH = 2 })">
                <BotInfoWidget Bot="@VM?.Value"
                              BotId="@BotId"
                              Status="@HarnessStatus"
                              OperationInProgress="@_operationInProgress"
                              OnStart="StartBot"
                              OnStop="StopBot"
                              OnSave="Save" />
            </BlazorGridStackWidget>

            @* Open Positions Widget *@
            <BlazorGridStackWidget WidgetOptions="@(new() { X = 0, Y = 4, W = 6, H = 3, Id = "positions", MinW = 3, MinH = 2 })">
                <OpenPositionsWidget Positions="@OpenPositions" />
            </BlazorGridStackWidget>

            @* Open Orders Widget *@
            <BlazorGridStackWidget WidgetOptions="@(new() { X = 6, Y = 4, W = 6, H = 3, Id = "orders", MinW = 3, MinH = 2 })">
                <OrdersWidget Orders="@OpenOrders" />
            </BlazorGridStackWidget>

            @* Trade History Widget *@
            <BlazorGridStackWidget WidgetOptions="@(new() { X = 0, Y = 7, W = 6, H = 3, Id = "trades", MinW = 3, MinH = 2 })">
                <ClosedPositionsWidget Positions="@ClosedPositions" />
            </BlazorGridStackWidget>

            @* Logs Widget *@
            <BlazorGridStackWidget WidgetOptions="@(new() { X = 6, Y = 7, W = 6, H = 3, Id = "logs", MinW = 3, MinH = 2 })">
                <LogsWidget BotId="@BotId" />
            </BlazorGridStackWidget>

        </BlazorGridStackBody>
    </div>
</div>
